(function() {
  var filteredEnv, fs, path, pty, _;

  pty = require('pty.js');

  path = require('path');

  fs = require('fs');

  _ = require('underscore');

  filteredEnv = (function() {
    var env;
    env = _.omit(process.env, 'ATOM_HOME', 'ATOM_SHELL_INTERNAL_RUN_AS_NODE', 'GOOGLE_API_KEY', 'NODE_ENV', 'NODE_PATH', 'userAgent', 'taskPath');
    env.LANG = 'en_US.UTF-8';
    env.TERM_PROGRAM = 'Terminal-Plus';
    return env;
  })();

  module.exports = function(ptyCwd, shell, args, options) {
    var callback, ptyProcess, title;
    if (options == null) {
      options = {};
    }
    callback = this.async();
    if (/zsh|bash/.test(shell) && args.indexOf('--login') === -1) {
      args.unshift('--login');
    }
    ptyProcess = pty.fork(shell, args, {
      cwd: ptyCwd,
      env: filteredEnv,
      name: 'xterm-256color'
    });
    title = shell = path.basename(shell);
    ptyProcess.on('data', function(data) {
      return emit('terminal-plus:data', data);
    });
    ptyProcess.on('data', function() {
      var newTitle;
      newTitle = ptyProcess.process;
      if (newTitle === shell) {
        emit('terminal-plus:clear-title');
      } else if (title !== newTitle) {
        emit('terminal-plus:title', newTitle);
      }
      return title = newTitle;
    });
    ptyProcess.on('exit', function() {
      emit('terminal-plus:exit');
      return callback();
    });
    return process.on('message', function(_arg) {
      var cols, event, rows, text, _ref;
      _ref = _arg != null ? _arg : {}, event = _ref.event, cols = _ref.cols, rows = _ref.rows, text = _ref.text;
      switch (event) {
        case 'resize':
          return ptyProcess.resize(cols, rows);
        case 'input':
          return ptyProcess.write(text);
      }
    });
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAiZmlsZSI6ICIiLAogICJzb3VyY2VSb290IjogIiIsCiAgInNvdXJjZXMiOiBbCiAgICAiL2hvbWUvcGppbS8uYXRvbS9wYWNrYWdlcy90ZXJtaW5hbC1wbHVzL2xpYi9wcm9jZXNzLmNvZmZlZSIKICBdLAogICJuYW1lcyI6IFtdLAogICJtYXBwaW5ncyI6ICJBQUFBO0FBQUEsTUFBQSw2QkFBQTs7QUFBQSxFQUFBLEdBQUEsR0FBTSxPQUFBLENBQVEsUUFBUixDQUFOLENBQUE7O0FBQUEsRUFDQSxJQUFBLEdBQU8sT0FBQSxDQUFRLE1BQVIsQ0FEUCxDQUFBOztBQUFBLEVBRUEsRUFBQSxHQUFLLE9BQUEsQ0FBUSxJQUFSLENBRkwsQ0FBQTs7QUFBQSxFQUdBLENBQUEsR0FBSSxPQUFBLENBQVEsWUFBUixDQUhKLENBQUE7O0FBQUEsRUFLQSxXQUFBLEdBQWlCLENBQUEsU0FBQSxHQUFBO0FBQ2YsUUFBQSxHQUFBO0FBQUEsSUFBQSxHQUFBLEdBQU0sQ0FBQyxDQUFDLElBQUYsQ0FBTyxPQUFPLENBQUMsR0FBZixFQUFvQixXQUFwQixFQUFpQyxpQ0FBakMsRUFBb0UsZ0JBQXBFLEVBQXNGLFVBQXRGLEVBQWtHLFdBQWxHLEVBQStHLFdBQS9HLEVBQTRILFVBQTVILENBQU4sQ0FBQTtBQUFBLElBQ0EsR0FBRyxDQUFDLElBQUosR0FBVyxhQURYLENBQUE7QUFBQSxJQUVBLEdBQUcsQ0FBQyxZQUFKLEdBQW1CLGVBRm5CLENBQUE7V0FHQSxJQUplO0VBQUEsQ0FBQSxDQUFILENBQUEsQ0FMZCxDQUFBOztBQUFBLEVBV0EsTUFBTSxDQUFDLE9BQVAsR0FBaUIsU0FBQyxNQUFELEVBQVMsS0FBVCxFQUFnQixJQUFoQixFQUFzQixPQUF0QixHQUFBO0FBQ2YsUUFBQSwyQkFBQTs7TUFEcUMsVUFBUTtLQUM3QztBQUFBLElBQUEsUUFBQSxHQUFXLElBQUMsQ0FBQSxLQUFELENBQUEsQ0FBWCxDQUFBO0FBRUEsSUFBQSxJQUFHLFVBQVUsQ0FBQyxJQUFYLENBQWdCLEtBQWhCLENBQUEsSUFBMkIsSUFBSSxDQUFDLE9BQUwsQ0FBYSxTQUFiLENBQUEsS0FBMkIsQ0FBQSxDQUF6RDtBQUNFLE1BQUEsSUFBSSxDQUFDLE9BQUwsQ0FBYSxTQUFiLENBQUEsQ0FERjtLQUZBO0FBQUEsSUFLQSxVQUFBLEdBQWEsR0FBRyxDQUFDLElBQUosQ0FBUyxLQUFULEVBQWdCLElBQWhCLEVBQ1g7QUFBQSxNQUFBLEdBQUEsRUFBSyxNQUFMO0FBQUEsTUFDQSxHQUFBLEVBQUssV0FETDtBQUFBLE1BRUEsSUFBQSxFQUFNLGdCQUZOO0tBRFcsQ0FMYixDQUFBO0FBQUEsSUFVQSxLQUFBLEdBQVEsS0FBQSxHQUFRLElBQUksQ0FBQyxRQUFMLENBQWMsS0FBZCxDQVZoQixDQUFBO0FBQUEsSUFZQSxVQUFVLENBQUMsRUFBWCxDQUFjLE1BQWQsRUFBc0IsU0FBQyxJQUFELEdBQUE7YUFDcEIsSUFBQSxDQUFLLG9CQUFMLEVBQTJCLElBQTNCLEVBRG9CO0lBQUEsQ0FBdEIsQ0FaQSxDQUFBO0FBQUEsSUFlQSxVQUFVLENBQUMsRUFBWCxDQUFjLE1BQWQsRUFBc0IsU0FBQSxHQUFBO0FBQ3BCLFVBQUEsUUFBQTtBQUFBLE1BQUEsUUFBQSxHQUFXLFVBQVUsQ0FBQyxPQUF0QixDQUFBO0FBQ0EsTUFBQSxJQUFHLFFBQUEsS0FBWSxLQUFmO0FBQ0UsUUFBQSxJQUFBLENBQUssMkJBQUwsQ0FBQSxDQURGO09BQUEsTUFFSyxJQUFPLEtBQUEsS0FBUyxRQUFoQjtBQUNILFFBQUEsSUFBQSxDQUFLLHFCQUFMLEVBQTRCLFFBQTVCLENBQUEsQ0FERztPQUhMO2FBS0EsS0FBQSxHQUFRLFNBTlk7SUFBQSxDQUF0QixDQWZBLENBQUE7QUFBQSxJQXVCQSxVQUFVLENBQUMsRUFBWCxDQUFjLE1BQWQsRUFBc0IsU0FBQSxHQUFBO0FBQ3BCLE1BQUEsSUFBQSxDQUFLLG9CQUFMLENBQUEsQ0FBQTthQUNBLFFBQUEsQ0FBQSxFQUZvQjtJQUFBLENBQXRCLENBdkJBLENBQUE7V0EyQkEsT0FBTyxDQUFDLEVBQVIsQ0FBVyxTQUFYLEVBQXNCLFNBQUMsSUFBRCxHQUFBO0FBQ3BCLFVBQUEsNkJBQUE7QUFBQSw0QkFEcUIsT0FBMEIsSUFBekIsYUFBQSxPQUFPLFlBQUEsTUFBTSxZQUFBLE1BQU0sWUFBQSxJQUN6QyxDQUFBO0FBQUEsY0FBTyxLQUFQO0FBQUEsYUFDTyxRQURQO2lCQUNxQixVQUFVLENBQUMsTUFBWCxDQUFrQixJQUFsQixFQUF3QixJQUF4QixFQURyQjtBQUFBLGFBRU8sT0FGUDtpQkFFb0IsVUFBVSxDQUFDLEtBQVgsQ0FBaUIsSUFBakIsRUFGcEI7QUFBQSxPQURvQjtJQUFBLENBQXRCLEVBNUJlO0VBQUEsQ0FYakIsQ0FBQTtBQUFBIgp9

//# sourceURL=/home/pjim/.atom/packages/terminal-plus/lib/process.coffee
